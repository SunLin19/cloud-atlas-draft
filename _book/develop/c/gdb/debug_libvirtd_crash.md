开发libvirt模块功能，调试时不断遇到libvirtd出现crash现象，生成core文件。

* 使用 `gdb` 加载 core 文件：

```
gdb libvirtd gdb libvirtd core-libvirtd-9083-1545202749-e03b01370.eu6sqa
```

显示输出

```
Reading symbols from /usr/sbin/libvirtd...done.
[New LWP 9087]
[New LWP 9089]
[New LWP 9091]
[New LWP 9083]
[New LWP 9086]
[New LWP 9092]
[New LWP 9088]
[New LWP 9090]
[New LWP 9093]
[New LWP 9094]
[New LWP 9085]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib64/libthread_db.so.1".
Core was generated by `libvirtd --daemon --listen --switch 0'.
Program terminated with signal 6, Aborted.
#0  0x00007f681a3ae277 in raise () from /lib64/libc.so.6
Missing separate debuginfos, use: debuginfo-install audit-libs-2.4.1-5.1.alios7.x86_64 avahi-libs-0.6.31-15.1.alios7.x86_64 bzip2-libs-1.0.6-13.1.alios7.x86_64 cyrus-sasl-lib-2.1.26-19.2.1.alios7.x86_64 dbus-libs-1.6.12-13.1.alios7.x86_64 device-mapper-libs-1.02.107-5.1.alios7.x86_64 elfutils-libelf-0.163-3.alios7.x86_64 elfutils-libs-0.163-3.alios7.x86_64 glibc-2.17-222.alios7.1.x86_64 gmp-6.0.0-11.1.alios7.x86_64 gnutls-3.3.26-9.alios7.x86_64 keyutils-libs-1.5.8-3.1.alios7.x86_64 krb5-libs-1.15.1-19.1.alios7.x86_64 libattr-2.4.46-12.1.alios7.x86_64 libcap-2.22-8.1.alios7.x86_64 libcom_err-1.43.5-8.alios7.x86_64 libcurl-7.29.0-42.alios7.1.x86_64 libffi-3.0.13-16.1.alios7.x86_64 libgcc-4.8.5-28.alios7.1.x86_64 libgcrypt-1.5.3-14.alios7.x86_64 libgpg-error-1.12-3.1.alios7.x86_64 libidn-1.28-4.1.alios7.x86_64 libnl3-3.2.28-4.1.alios7.x86_64 libpcap-1.5.3-8.1.alios7.x86_64 libpciaccess-0.13.4-2.1.alios7.x86_64 libselinux-2.5-12.1.alios7.x86_64 libsepol-2.5-8.1.1.alios7.x86_64 libssh2-1.4.3-10.1.alios7.x86_64 libtasn1-4.10-1.alios7.x86_64 libxml2-2.9.1-6.alios7.3.x86_64 nettle-2.7.1-8.1.alios7.x86_64 nspr-4.13.1-1.0.alios7.x86_64 nss-3.28.4-15.alios7.x86_64 nss-softokn-freebl-3.28.3-6.alios7.x86_64 nss-util-3.28.4-3.alios7.x86_64 numactl-libs-2.0.9-5.1.alios7.x86_64 openldap-2.4.44-5.alios7.x86_64 openssl-libs-1.0.2k-12.1.alios7.x86_64 p11-kit-0.23.5-3.alios7.x86_64 pcre-8.32-15.1.alios7.x86_64 systemd-libs-219-42.4.alios7.x86_64 xz-libs-5.1.2-12alpha.1.alios7.x86_64 yajl-2.0.4-4.1.alios7.x86_64 zlib-1.2.7-16.2.alios7.x86_64
```

* 使用`bt`指令

```
#0  0x00007f681a3ae277 in raise () from /lib64/libc.so.6
#1  0x00007f681a3af968 in abort () from /lib64/libc.so.6
#2  0x00007f681a3f0d37 in __libc_message () from /lib64/libc.so.6
#3  0x00007f681a3f9499 in _int_free () from /lib64/libc.so.6
#4  0x00007f68055132cb in qemuDomainMigratePrepare3Params (dconn=<optimized out>, params=0x7f67f00019f0, nparams=4,
    cookiein=0x0, cookieinlen=0, cookieout=0x7f67f0017680, cookieoutlen=0x7f680a880b74, uri_out=0x7f67f00010d0,
    flags=6291457) at qemu/qemu_driver.c:15820
...
```

这里指出的问题显示出现异常是 qemu/qemu_driver.c 的 第15820行：

在这行代码，重复释放申请的内存，导致异常。。。

# 参考

* [How to get a core dump for a segfault on Linux](https://jvns.ca/blog/2018/04/28/debugging-a-segfault-on-linux/)
* [gdb Debugging Full Example (Tutorial): ncurses](http://www.brendangregg.com/blog/2016-08-09/gdb-example-ncurses.html)